---
import { Image } from "astro:assets";
const { project } = Astro.props;

// Check if cover image is a video (MP4 or WebM) or GIF
const coverImg = project.data.img;
// Content collections import videos as strings (from public folder), images/GIFs as objects (from content)
const isVideo =
  typeof coverImg === "string" &&
  (coverImg.includes(".mp4") || coverImg.includes(".webm"));

const isGif =
  typeof coverImg === "object" &&
  coverImg?.src &&
  coverImg.src.includes(".gif");

// Add BASE_URL to video paths (handle paths that already start with /)
const baseUrl = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL.slice(0, -1)
  : import.meta.env.BASE_URL;
const videoSrc = isVideo
  ? coverImg.startsWith("/")
    ? `${baseUrl}${coverImg}`
    : `${import.meta.env.BASE_URL}${coverImg}`
  : null;
---

{
  project ? (
    <a
      href={`${import.meta.env.BASE_URL}/projects/${project.id}`}
      class="project-card"
      data-project-id={project.id}
    >
      <div class="card-image-wrapper">
        <div class="card-tags">
          {project.data.creativeField.map((field: string) => (
            <span class="tag">{field}</span>
          ))}
        </div>
        {isVideo ? (
          <video
            autoplay
            loop
            muted
            playsinline
            class="card-cover carousel-video"
          >
            <source
              src={videoSrc}
              type={coverImg.includes(".webm") ? "video/webm" : "video/mp4"}
            />
          </video>
        ) : isGif ? (
          <img src={coverImg.src} alt={project.data.name} class="card-cover" />
        ) : (
          <Image
            src={project.data.img}
            alt={project.data.name}
            class="card-cover"
            widths={[260, 300, 450]}
            sizes="(min-width: 64rem) 450px, (min-width: 40rem) 300px, 260px"
            format="webp"
          />
        )}
      </div>
      <div class="card-title">{project.data.name}</div>
    </a>
  ) : (
    <p>No project found</p>
  )
}
