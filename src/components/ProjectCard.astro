---
import { Image } from "astro:assets";
const { project } = Astro.props;

// Check if cover image is a video (MP4 or WebM)
const coverImg = project.data.img;
// Content collections import videos as strings (from public folder), images as objects (from content)
const isVideo =
  typeof coverImg === "string" &&
  (coverImg.includes(".mp4") || coverImg.includes(".webm"));

// Add BASE_URL to video paths
const videoSrc = isVideo ? `${import.meta.env.BASE_URL}${coverImg}` : null;
---

{
  project ? (
    <a
      href={`${import.meta.env.BASE_URL}/projects/${project.id}`}
      class="project-card"
      data-project-id={project.id}
    >
      <div class="card-image-wrapper">
        <div class="card-tags">
          {project.data.creativeField.map((field: string) => (
            <span class="tag">{field}</span>
          ))}
        </div>
        {isVideo ? (
          <video autoplay loop muted playsinline class="card-cover">
            <source
              src={videoSrc}
              type={coverImg.includes(".webm") ? "video/webm" : "video/mp4"}
            />
          </video>
        ) : (
          <Image
            src={project.data.img}
            alt={project.data.name}
            class="card-cover"
            widths={[260, 300, 450]}
            sizes="(min-width: 64rem) 450px, (min-width: 40rem) 300px, 260px"
            format="webp"
          />
        )}
      </div>
      <div class="card-title">{project.data.name}</div>
    </a>
  ) : (
    <p>No project found</p>
  )
}
