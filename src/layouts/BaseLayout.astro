---
import "../styles/global.css";

interface Props {
  title: string;
  withLoadingState?: boolean;
}

const { withLoadingState = false } = Astro.props;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta property="og:title" content="Mauro Vangheluwe" />
    <meta
      property="og:description"
      content="Interactive portfolio of Mauro Vangheluwe, a digital designer & developer."
    />
    <meta
      property="og:image"
      content="https://maurovangheluwe.github.io/Portfolio/preview.png"
    />
    <meta
      property="og:url"
      content="https://maurovangheluwe.github.io/Portfolio"
    />
    <meta property="og:type" content="website" />

    <link rel="stylesheet" href="https://use.typekit.net/hpf4uwp.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Schoolbell&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23B3D7E7' /%3E%3Ccircle cx='50' cy='50' r='20' fill='%231393D1' /%3E%3C/svg%3E"
    />

    <title>Mauro Vangheluwe</title>
    <script is:inline>
      let originalTitle = document.title;
      let timeout;

      document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
          // Start timer when user leaves the tab
          timeout = setTimeout(() => {
            document.title = "Wait, come back ðŸ˜”";
          }, 2000);
        } else {
          // User returned â†’ reset
          clearTimeout(timeout);
          document.title = originalTitle;
        }
      });
    </script>
  </head>
  <body class:list={[{ loading: withLoadingState }]}>
    <div id="star-background"></div>
    <div id="smooth-wrapper">
      <div id="smooth-content">
        {withLoadingState && <div id="loading-overlay" />}
        <slot />
      </div>
    </div>
    <div id="fixed-elements">
      <slot name="fixed" />
    </div>
    <script>
      import { setupSmoother } from "../scripts/smoother.js";
      setupSmoother();
    </script>
    <script>
      // Generate random star pattern
      const starBackground = document.getElementById("star-background");
      if (starBackground) {
        const starSize = 50; // 50x50px
        const spacing = 120; // minimum spacing between stars to prevent overlap
        const viewportWidth = window.innerWidth;
        const viewportHeight = document.documentElement.scrollHeight;

        const stars: { x: number; y: number }[] = [];

        // Helper to check if position overlaps with existing stars
        function hasOverlap(x: number, y: number): boolean {
          return stars.some((star) => {
            const distance = Math.sqrt(
              Math.pow(x - star.x, 2) + Math.pow(y - star.y, 2)
            );
            return distance < spacing;
          });
        }

        // Generate random positions
        const maxAttempts = 300;
        const desiredStars = Math.floor(
          (viewportWidth * viewportHeight) / (spacing * spacing * 3)
        );

        for (let i = 0; i < maxAttempts && stars.length < desiredStars; i++) {
          const x = Math.random() * (viewportWidth - starSize);
          const y = Math.random() * (viewportHeight - starSize);

          if (!hasOverlap(x, y)) {
            stars.push({ x, y });

            const starSvg = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "svg"
            );
            starSvg.setAttribute("width", starSize.toString());
            starSvg.setAttribute("height", starSize.toString());
            starSvg.setAttribute("viewBox", "0 0 22 23");
            starSvg.setAttribute("fill", "none");
            starSvg.style.position = "absolute";
            starSvg.style.left = `${x}px`;
            starSvg.style.top = `${y}px`;
            starSvg.style.opacity = "0.3";
            starSvg.style.pointerEvents = "none";
            starSvg.style.zIndex = "1";

            const path = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "path"
            );
            path.setAttribute(
              "d",
              "M10.067 0.587755C10.4216 -0.195914 11.5345 -0.195913 11.8891 0.587757L12.9684 2.97294C13.2111 3.50939 13.8625 3.72104 14.3742 3.42972L16.6493 2.13444C17.3968 1.70887 18.2972 2.36304 18.1235 3.20547L17.5946 5.7695C17.4757 6.34618 17.8783 6.90028 18.4635 6.96537L21.0654 7.25475C21.9203 7.34982 22.2642 8.40829 21.6285 8.98771L19.6936 10.7512C19.2584 11.1478 19.2584 11.8328 19.6936 12.2294L21.6285 13.9929C22.2642 14.5723 21.9203 15.6308 21.0654 15.7258L18.4635 16.0152C17.8783 16.0803 17.4757 16.6344 17.5946 17.2111L18.1235 19.7751C18.2972 20.6176 17.3968 21.2717 16.6493 20.8461L14.3742 19.5509C13.8625 19.2595 13.2111 19.4712 12.9684 20.0077L11.8891 22.3928C11.5345 23.1765 10.4216 23.1765 10.067 22.3928L8.98769 20.0077C8.74495 19.4712 8.09356 19.2595 7.58186 19.5509L5.30675 20.8461C4.55924 21.2717 3.65885 20.6176 3.8326 19.7751L4.36144 17.2111C4.48038 16.6344 4.07779 16.0803 3.49258 16.0152L0.890632 15.7258C0.0357406 15.6308 -0.308176 14.5723 0.32756 13.9929L2.26249 12.2294C2.69768 11.8328 2.69768 11.1478 2.26249 10.7512L0.327559 8.98771C-0.308177 8.40829 0.0357419 7.34982 0.890633 7.25475L3.49258 6.96537C4.0778 6.90028 4.48038 6.34618 4.36144 5.7695L3.8326 3.20547C3.65885 2.36304 4.55924 1.70887 5.30675 2.13444L7.58186 3.42972C8.09356 3.72104 8.74495 3.50939 8.98769 2.97294L10.067 0.587755Z"
            );
            path.setAttribute("fill", "#041D29");

            starSvg.appendChild(path);
            starBackground.appendChild(starSvg);
          }
        }
      }
    </script>
  </body>

  <style is:global>
    #star-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }

    #smooth-wrapper {
      position: relative;
      z-index: 10;
    }

    #fixed-elements {
      position: relative;
      pointer-events: none;
    }

    #fixed-elements > * {
      pointer-events: auto;
    }
  </style>
</html>
