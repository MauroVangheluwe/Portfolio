---
import "../styles/global.css";
import Footer from "../components/Footer.astro";

interface Props {
  title: string;
  withLoadingState?: boolean;
  hideFooter?: boolean;
}

const { withLoadingState = false, hideFooter = false } = Astro.props;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta property="og:title" content="Mauro Vangheluwe" />
    <meta
      property="og:description"
      content="Interactive portfolio of Mauro Vangheluwe, a digital designer & developer."
    />
    <meta
      property="og:image"
      content="https://maurovangheluwe.github.io/Portfolio/preview.png"
    />
    <meta
      property="og:url"
      content="https://maurovangheluwe.github.io/Portfolio"
    />
    <meta property="og:type" content="website" />

    <link rel="stylesheet" href="https://use.typekit.net/hpf4uwp.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Schoolbell&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23B3D7E7' /%3E%3Ccircle cx='50' cy='50' r='20' fill='%231393D1' /%3E%3C/svg%3E"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-..."
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <title>Mauro Vangheluwe</title>
    <script is:inline>
      let originalTitle = document.title;
      let timeout;

      document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
          // Start timer when user leaves the tab
          timeout = setTimeout(() => {
            document.title = "Wait, come back ðŸ˜”";
          }, 2000);
        } else {
          // User returned â†’ reset
          clearTimeout(timeout);
          document.title = originalTitle;
        }
      });
    </script>
  </head>
  <body class:list={[{ loading: withLoadingState }]}>
    <div id="star-background"></div>
    <div id="smooth-wrapper">
      <div id="smooth-content">
        {withLoadingState && <div id="loading-overlay" />}
        <slot />
        {!hideFooter && <Footer />}
      </div>
    </div>
    <div id="fixed-elements">
      <slot name="fixed" />
    </div>
    <script>
      import { setupSmoother } from "../scripts/smoother.js";
      setupSmoother();
    </script>
    <script>
      // Generate random star pattern
      const starBackground = document.getElementById("star-background");
      if (starBackground) {
        const starSize = 50; // 50x50px
        const spacing = 120; // minimum spacing between stars to prevent overlap
        const viewportWidth = window.innerWidth;
        const viewportHeight = document.documentElement.scrollHeight;

        const stars: { x: number; y: number }[] = [];

        // Helper to check if position overlaps with existing stars
        function hasOverlap(x: number, y: number): boolean {
          return stars.some((star) => {
            const distance = Math.sqrt(
              Math.pow(x - star.x, 2) + Math.pow(y - star.y, 2)
            );
            return distance < spacing;
          });
        }

        // Generate random positions
        const maxAttempts = 300;
        const desiredStars = Math.floor(
          (viewportWidth * viewportHeight) / (spacing * spacing * 3)
        );

        for (let i = 0; i < maxAttempts && stars.length < desiredStars; i++) {
          const x = Math.random() * (viewportWidth - starSize);
          const y = Math.random() * (viewportHeight - starSize);

          if (!hasOverlap(x, y)) {
            stars.push({ x, y });

            const starSvg = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "svg"
            );
            starSvg.setAttribute("width", starSize.toString());
            starSvg.setAttribute("height", starSize.toString());
            starSvg.setAttribute("viewBox", "0 0 22 24");
            starSvg.setAttribute("fill", "none");
            starSvg.style.position = "absolute";
            starSvg.style.left = `${x}px`;
            starSvg.style.top = `${y}px`;
            starSvg.style.opacity = "0.3";
            starSvg.style.pointerEvents = "none";
            starSvg.style.zIndex = "1";

            const path = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "path"
            );
            path.setAttribute(
              "d",
              "M11 0L13.1889 4.83178L17.8237 2.27639L16.5407 7.62087L22 8.50794L18.0439 12L22 15.4921L16.5407 16.3791L17.8237 21.7236L13.1889 19.1682L11 24L8.81114 19.1682L4.17634 21.7236L5.45931 16.3791L0 15.4921L3.95614 12L0 8.50794L5.45931 7.62087L4.17634 2.27639L8.81114 4.83178L11 0Z"
            );
            path.setAttribute("fill", "#041D29");

            starSvg.appendChild(path);
            starBackground.appendChild(starSvg);
          }
        }
      }
    </script>
  </body>

  <style is:global>
    #star-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }

    #smooth-wrapper {
      position: relative;
      z-index: 10;
    }

    #fixed-elements {
      position: relative;
      pointer-events: none;
    }

    #fixed-elements > * {
      pointer-events: auto;
    }
  </style>
</html>
