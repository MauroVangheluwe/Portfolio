---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import Topscroll from "../components/Topscroll.astro";
import heroImage1 from "../assets/Hero-image-1.png";
import heroImage2 from "../assets/Hero-image-2.png";
import heroImage3 from "../assets/Hero-image-3.gif";
import heroImage4 from "../assets/Hero-image-4.png";
import ProjectCard from "../components/ProjectCard.astro";

const projects = await getCollection("projects");
---

<BaseLayout title="Mauro Vangheluwe">
  <main>
    <Topscroll />
    <div class="hero-container">
      <div class="hero-title-wrap">
        <p class="hero-top-title">Digital Designer & Developer</p>
        <h1 class="hero-title">
          <span class="first-word">Mauro</span>
          <span class="second-word">Vangheluwe</span>
        </h1>
      </div>

      <div class="heroimages" id="heroimages">
        <div class="heroimage" data-index="0" data-rotate="2deg">
          <img src={heroImage1.src} alt="Hero 1" />
        </div>
        <div class="heroimage" data-index="1" data-rotate="-3deg">
          <img src={heroImage2.src} alt="Hero 2" />
        </div>
        <div class="heroimage" data-index="2" data-rotate="6deg">
          <img src={heroImage3.src} alt="Hero 3" />
        </div>
        <div class="heroimage" data-index="3" data-rotate="-2deg">
          <img src={heroImage4.src} alt="Hero 4" />
        </div>
      </div>
    </div>

    <h2 class="work-title">Featured Work</h2>
    <h3 class="work-subtitle">Some Remarkable Projects</h3>
    <div class="projects-container">
      {projects.map((project) => <ProjectCard project={project} />)}
    </div>

    <!-- JS goes here, after the DOM elements -->
    <script>
      const heroImages = document.querySelectorAll(".heroimage");
      const container = document.getElementById("heroimages");

      window.addEventListener("load", () => {
        if (container) {
          container.classList.add("heromounted");
        }
      });

      let mouseX = window.innerWidth / 2;
      let mouseY = window.innerHeight / 2;
      let prevMouseX = mouseX;
      let prevMouseY = mouseY;

      document.addEventListener("mousemove", (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
      });

      // Adjust individual intensity per image here
      const intensities = [0.1, 0.06, 0.08, 0.12]; // image 0, 1, 2, 3

      function animate() {
        if (!container) return;

        const containerRect = container.getBoundingClientRect();
        const containerCenterX = containerRect.left + containerRect.width / 2;
        const containerCenterY = containerRect.top + containerRect.height / 2;

        // Calculate offset from container center
        const offsetX = mouseX - containerCenterX;
        const offsetY = mouseY - containerCenterY;

        // Calculate mouse velocity for rotation
        const velocityX = mouseX - prevMouseX;
        const velocityY = mouseY - prevMouseY;
        prevMouseX = mouseX;
        prevMouseY = mouseY;

        heroImages.forEach((img, index) => {
          if (!(img instanceof HTMLElement)) return;

          const strength = intensities[index];

          const moveX = offsetX * strength;
          const moveY = offsetY * strength;

          // Add rotation based on horizontal velocity
          const rotateAttr = img.getAttribute("data-rotate") ?? "0";
          const baseRotate = parseFloat(rotateAttr) || 0;
          const dynamicRotate = velocityX * 0.05;
          const totalRotate = baseRotate + dynamicRotate;

          img.style.transform = `translate(${moveX}px, ${moveY}px) rotate(${totalRotate}deg)`;
        });
        requestAnimationFrame(animate);
      }
      animate();
    </script>

    <!-- GSAP timeline: loaded via external module so Vite resolves imports -->
    <script type="module" src="/src/scripts/hero-anim.js"></script>
  </main>
</BaseLayout>
